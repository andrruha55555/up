<!-- MainPage.xaml -->
<Window x:Class="AdminUP.MainPage"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         mc:Ignorable="d" 
        Title="AdminUP - Панель управления" 
        Height="800" Width="1400"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        Loaded="Window_Loaded"
        Closing="Window_Closing">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid>
        <!-- Индикатор загрузки -->
        <Border Style="{StaticResource LoadingOverlay}" 
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="20"/>
                <TextBlock Text="Загрузка данных..." Foreground="White" Margin="0 10 0 0"/>
            </StackPanel>
        </Border>

        <!-- Верхняя панель -->
        <Border Height="60" Background="{StaticResource PrimaryBrush}" VerticalAlignment="Top">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Логотип и название -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="20 0">
                    <TextBlock Text="🏢 AdminUP" Foreground="White" FontSize="22" 
                               FontWeight="Bold" VerticalAlignment="Center"/>
                    <TextBlock Text=" | Панель управления" 
                               Foreground="White" FontSize="16" 
                               Margin="10 0 0 0" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Статус -->
                <TextBlock Grid.Column="1" Text="{Binding StatusMessage}" 
                           Foreground="White" FontSize="14" 
                           VerticalAlignment="Center" HorizontalAlignment="Center"/>

                <!-- Кнопки управления -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0 0 20 0">
                    <Button Content="🔄 Обновить" Width="100" Margin="5 0" 
                            Click="RefreshButton_Click" ToolTip="Обновить все данные"/>
                    <Button Content="🚪 Выход" Width="80" Margin="5 0" 
                            Click="LogoutButton_Click" ToolTip="Выйти из системы"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Основной контент -->
        <TabControl Margin="10 70 10 50" x:Name="MainTabControl">

            <!-- Вкладка 1: Оборудование -->
            <TabItem Header="📦 Оборудование">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <DataGrid x:Name="EquipmentGrid" Grid.Row="0"
                             ItemsSource="{Binding EquipmentList}" 
                             SelectedItem="{Binding SelectedEquipment}"
                             AutoGenerateColumns="False" 
                             CanUserAddRows="False"
                             MouseDoubleClick="EquipmentGrid_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Название" Binding="{Binding Name}" Width="200"/>
                            <DataGridTextColumn Header="Инв.номер" Binding="{Binding InventoryNumber}" Width="100"/>
                            <DataGridTextColumn Header="Аудитория" Binding="{Binding ClassroomId}" Width="80"/>
                            <DataGridTextColumn Header="Ответственный" Binding="{Binding ResponsibleUserId}" Width="120"/>
                            <DataGridTextColumn Header="Стоимость" Binding="{Binding Cost, StringFormat={}{0:N2}}" Width="100"/>
                            <DataGridTextColumn Header="Статус" Binding="{Binding StatusId}" Width="100"/>
                            <DataGridTextColumn Header="Дата создания" Binding="{Binding CreatedAt, StringFormat={}{0:dd.MM.yyyy}}" Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Детальная информация -->
                    <Border Grid.Row="1" Background="#F8F9FA" BorderBrush="#DDDDDD" BorderThickness="0,1,0,0"
                            Visibility="{Binding IsEquipmentSelected, Converter={StaticResource BoolToVis}}">
                        <views:EquipmentDetailControl DataContext="{Binding SelectedEquipment}" 
                                                     Margin="10" Height="150"/>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Вкладка 2: Пользователи -->
            <TabItem Header="👥 Пользователи">
                <DataGrid x:Name="UserGrid" ItemsSource="{Binding UserList}" 
                         AutoGenerateColumns="False" CanUserAddRows="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Логин" Binding="{Binding Login}" Width="100"/>
                        <DataGridTextColumn Header="Фамилия" Binding="{Binding LastName}" Width="120"/>
                        <DataGridTextColumn Header="Имя" Binding="{Binding FirstName}" Width="120"/>
                        <DataGridTextColumn Header="Роль" Binding="{Binding Role}" Width="100"/>
                        <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="150"/>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- Остальные вкладки аналогично... -->

        </TabControl>

        <!-- Панель инструментов -->
        <Border Height="50" Background="#E0E0E0" VerticalAlignment="Bottom">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Поиск -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="10" VerticalAlignment="Center">
                    <TextBlock Text="Поиск:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox x:Name="SearchTextBox" Width="300" 
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             KeyDown="SearchTextBox_KeyDown"/>
                    <Button Content="Очистить" Width="80" Margin="5,0" Click="ClearSearchButton_Click"/>
                </StackPanel>

                <!-- Действия -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="10">
                    <Button x:Name="AddButton" Content="➕ Добавить" Width="100" Margin="0,0,5,0" 
                            Click="AddButton_Click" ToolTip="Добавить новый элемент"/>
                    <Button x:Name="EditButton" Content="✏️ Редактировать" Width="120" Margin="0,0,5,0" 
                            Click="EditButton_Click" ToolTip="Редактировать выбранный элемент"/>
                    <Button x:Name="DeleteButton" Content="🗑️ Удалить" Width="100" Margin="0,0,5,0" 
                            Click="DeleteButton_Click" ToolTip="Удалить выбранный элемент"/>
                    <Button x:Name="ExportButton" Content="📥 Экспорт" Width="100" Margin="0,0,5,0" 
                            Click="ExportButton_Click" ToolTip="Экспортировать данные в Excel"/>
                    <Button Content="🖨️ Печать" Width="80" Click="PrintButton_Click" ToolTip="Печать текущей таблицы"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>